# نظام إدارة السائقين والمحاسبة

نظام ويب شامل لإدارة السائقين، تتبع المدفوعات والمصاريف، إدارة المستندات، والتقارير المالية.

## 🚀 الميزات الرئيسية

### إدارة المستخدمين والصلاحيات
- أربعة أنواع من المستخدمين: مدير، محاسب، مشرف، سائق
- نظام صلاحيات متقدم لكل نوع مستخدم
- مصادقة آمنة باستخدام JWT

### إدارة السائقين
- ملفات شخصية كاملة للسائقين
- تتبع بيانات الرخص وتواريخ الانتهاء
- إدارة معلومات المركبات
- حالات مختلفة للسائقين (نشط، غير نشط، موقوف)

### النظام المالي
- تتبع دقيق للدخل والمصاريف لكل سائق
- أنواع معاملات متعددة: دخل، مصاريف، عمولات، خصومات، مكافآت
- حالات الموافقة على المعاملات
- حساب الرصيد الصافي تلقائياً

### إدارة المستندات
- رفع وتخزين المستندات (PDF، صور)
- تصنيف المستندات حسب النوع
- نظام التحقق من المستندات
- تتبع تواريخ انتهاء المستندات

### نظام الرحلات
- تسجيل تفاصيل الرحلات
- حساب المسافات والأجرة
- تتبع العمولات
- إحصائيات الأداء

### الإشعارات والتنبيهات
- تنبيهات انتهاء الرخص والمستندات
- إشعارات المعاملات المالية
- تنبيهات النظام
- أولويات مختلفة للإشعارات

### التقارير ولوحة التحكم
- لوحة تحكم تفاعلية مع الإحصائيات
- تقارير مالية مفصلة
- تقارير أداء السائقين
- تصدير البيانات إلى CSV

## 🛠️ التقنيات المستخدمة

### الواجهة الأمامية (Frontend)
- **Next.js 14** - إطار عمل React
- **Tailwind CSS** - تصميم سريع ومرن
- **Heroicons** - أيقونات جميلة
- **React Hook Form** - إدارة النماذج
- **React Hot Toast** - إشعارات المستخدم

### الخادم الخلفي (Backend)
- **Node.js** - بيئة تشغيل JavaScript
- **Express.js** - إطار عمل الخادم
- **Prisma** - ORM لقاعدة البيانات
- **SQLite/PostgreSQL** - قاعدة البيانات
- **JWT** - المصادقة والتفويض
- **Multer** - رفع الملفات
- **bcryptjs** - تشفير كلمات المرور

## 📋 متطلبات التشغيل

- Node.js 18+ 
- npm أو yarn
- SQLite (للتطوير) أو PostgreSQL (للإنتاج)

## 🚀 تعليمات التشغيل

### 1. تحميل المشروع

```bash
git clone <repository-url>
cd driver-management-system
```

### 2. تثبيت المتطلبات

```bash
npm install
```

### 3. إعداد متغيرات البيئة

```bash
# نسخ ملف البيئة
cp .env.example .env

# تعديل ملف .env حسب الحاجة
```

### 4. إعداد قاعدة البيانات

```bash
# إنشاء الجداول
npx prisma migrate dev --name init

# إدخال البيانات التجريبية
npx prisma db seed
```

### 5. تشغيل النظام

```bash
# تشغيل الخادم الخلفي
npm run server:dev

# في terminal آخر، تشغيل الواجهة الأمامية
npm run dev
```

### 6. الوصول للنظام

- الواجهة الأمامية: http://localhost:3000
- API الخلفي: http://localhost:5000

## 👥 حسابات تجريبية

| النوع | البريد الإلكتروني | كلمة المرور | الصلاحيات |
|-------|------------------|-------------|-----------|
| مدير | admin@example.com | 123456 | جميع الصلاحيات |
| محاسب | accountant@example.com | 123456 | المالية والتقارير |
| مشرف | supervisor@example.com | 123456 | إدارة السائقين |
| سائق | driver1@example.com | 123456 | عرض البيانات الشخصية |

## 📁 هيكل المشروع

```
driver-management-system/
├── app/                    # الواجهة الأمامية (Next.js)
│   ├── components/         # المكونات المشتركة
│   ├── contexts/          # Context للحالة العامة
│   ├── dashboard/         # صفحات لوحة التحكم
│   └── globals.css        # الأنماط العامة
├── server/                # الخادم الخلفي (Express)
│   ├── routes/           # مسارات API
│   ├── middleware/       # Middleware للمصادقة
│   └── index.js          # نقطة البداية
├── prisma/               # إعدادات قاعدة البيانات
│   ├── schema.prisma     # مخطط قاعدة البيانات
│   └── seed.js          # البيانات التجريبية
└── uploads/              # مجلد رفع الملفات
```

## 🔧 API Endpoints

### المصادقة
- `POST /api/auth/login` - تسجيل الدخول
- `POST /api/auth/register` - إنشاء حساب جديد
- `GET /api/auth/me` - بيانات المستخدم الحالي
- `PUT /api/auth/change-password` - تغيير كلمة المرور

### المستخدمين
- `GET /api/users` - جلب جميع المستخدمين
- `GET /api/users/:id` - جلب مستخدم واحد
- `POST /api/users` - إنشاء مستخدم جديد
- `PUT /api/users/:id` - تحديث مستخدم
- `DELETE /api/users/:id` - حذف مستخدم

### السائقين
- `GET /api/drivers` - جلب جميع السائقين
- `POST /api/drivers` - إنشاء سائق جديد
- `GET /api/drivers/:id` - جلب سائق واحد
- `PUT /api/drivers/:id` - تحديث بيانات السائق
- `GET /api/drivers/:id/balance` - رصيد السائق

### المعاملات المالية
- `GET /api/transactions` - جلب المعاملات
- `POST /api/transactions` - إنشاء معاملة جديدة
- `PUT /api/transactions/:id` - تحديث معاملة
- `PUT /api/transactions/:id/status` - تغيير حالة المعاملة
- `GET /api/transactions/export/csv` - تصدير CSV

### المستندات
- `GET /api/documents` - جلب المستندات
- `POST /api/documents/upload` - رفع مستند
- `GET /api/documents/:id/download` - تحميل مستند
- `PUT /api/documents/:id/verify` - التحقق من مستند

### الرحلات
- `GET /api/trips` - جلب الرحلات
- `POST /api/trips` - إنشاء رحلة جديدة
- `PUT /api/trips/:id` - تحديث رحلة
- `DELETE /api/trips/:id` - حذف رحلة

### الإشعارات
- `GET /api/notifications` - جلب الإشعارات
- `POST /api/notifications` - إنشاء إشعار
- `PUT /api/notifications/:id/read` - تحديد كمقروء
- `PUT /api/notifications/mark-all/read` - تحديد الكل كمقروء

### التقارير
- `GET /api/reports/dashboard` - تقرير لوحة التحكم
- `GET /api/reports/financial` - التقرير المالي
- `GET /api/reports/drivers-performance` - تقرير أداء السائقين
- `GET /api/reports/payouts` - تقرير المستحقات

## 🔒 الأمان

- تشفير كلمات المرور باستخدام bcrypt
- مصادقة JWT مع انتهاء صلاحية
- التحقق من الصلاحيات على مستوى API
- تشفير البيانات الحساسة
- سجلات التدقيق لجميع العمليات
- Rate limiting لمنع الهجمات

## 🚀 التطوير المستقبلي

### المرحلة الثانية
- [ ] تطبيق موبايل (React Native)
- [ ] إشعارات فورية (WebSocket)
- [ ] تكامل مع APIs البنوك
- [ ] نظام النسخ الاحتياطي التلقائي
- [ ] تقارير متقدمة مع رسوم بيانية

### المرحلة الثالثة
- [ ] ذكاء اصطناعي لتحليل الأداء
- [ ] OCR لاستخراج بيانات المستندات
- [ ] نظام GPS لتتبع الرحلات
- [ ] تطبيق PWA للعمل بدون إنترنت
- [ ] تعدد اللغات

## 🐛 الإبلاغ عن المشاكل

للإبلاغ عن مشاكل أو طلب ميزات جديدة، يرجى إنشاء issue في المستودع.

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT - راجع ملف [LICENSE](LICENSE) للتفاصيل.

---

تم تطوير هذا النظام بعناية لتلبية احتياجات إدارة السائقين والمحاسبة بطريقة حديثة وفعالة. 🚗💼